<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinSight Premium - Intelligent Statement Analysis</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- html2pdf.js for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <span class="logo-text">FinSight Premium</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <div class="upload-container">
                    <h1 class="main-title">Intelligent Statement Analysis</h1>
                    <p class="main-subtitle">Transform raw bank statements into actionable financial insights in seconds.</p>

                    <div class="upload-box" id="uploadBox">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M24 32V16M24 16L18 22M24 16L30 22" stroke="#6366f1" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M8 32V36C8 38.2091 9.79086 40 12 40H36C38.2091 40 40 38.2091 40 36V32" stroke="#6366f1" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 class="upload-title">Upload Statement</h3>
                            <p class="upload-text">Drag and drop your PDF or Screenshot here</p>
                            <div class="upload-formats">
                                <span class="format-badge">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0H4z"/>
                                        <path d="M9.5 0v4a.5.5 0 0 0 .5.5h4"/>
                                    </svg>
                                    PDF
                                </span>
                                <span class="format-divider"></span>
                                <span class="format-badge">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                    </svg>
                                    JPG/PNG
                                </span>
                            </div>
                            <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.webp" multiple hidden>
                        </div>
                    </div>

                    <div class="upload-status" id="uploadStatus"></div>
                </div>
            </section>

            <!-- File Preview Section -->
            <section class="preview-section" id="previewSection" style="display: none;">
                <div class="preview-container">
                    <h2 class="preview-title">Files Ready for Analysis</h2>
                    <p class="preview-subtitle">Review your files before starting the analysis</p>

                    <!-- File List -->
                    <div class="file-list" id="fileList">
                        <!-- File items will be inserted here -->
                    </div>

                    <!-- Action Buttons -->
                    <div class="preview-actions">
                        <button class="btn-secondary" onclick="addMoreFiles()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                            Add More Files
                        </button>
                        <button class="btn-primary" onclick="startAnalysis()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Start Analysis
                        </button>
                    </div>

                    <button class="btn-text" onclick="cancelUpload()">Cancel and Start Over</button>
                </div>
            </section>

            <!-- Encrypted PDF Warning -->
            <section class="warning-section" id="encryptedWarning" style="display: none;">
                <div class="warning-container">
                    <div class="warning-icon">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="12" y="20" width="24" height="20" rx="2" stroke="#f59e0b" stroke-width="2.5"/>
                            <path d="M16 20V14C16 9.58172 19.5817 6 24 6C28.4183 6 32 9.58172 32 14V20" stroke="#f59e0b" stroke-width="2.5"/>
                            <circle cx="24" cy="30" r="2" fill="#f59e0b"/>
                        </svg>
                    </div>
                    <h3 class="warning-title">PDF is Encrypted</h3>
                    <p class="warning-text">Unable to read this PDF directly. Please try one of the following:</p>
                    <div class="warning-actions">
                        <button class="btn-primary" onclick="switchToScreenshot()">
                            Upload Screenshot Instead
                        </button>
                        <button class="btn-secondary" onclick="resetUpload()">
                            Try Another File
                        </button>
                    </div>
                </div>
            </section>

            <!-- Loading Section -->
            <section class="loading-section" id="loadingSection" style="display: none;">
                <div class="loading-container">
                    <div class="loading-animation">
                        <div class="loading-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="8" y="12" width="32" height="24" rx="2" stroke="#6366f1" stroke-width="2"/>
                                <line x1="8" y1="20" x2="40" y2="20" stroke="#6366f1" stroke-width="2"/>
                                <circle cx="14" cy="16" r="1.5" fill="#6366f1"/>
                                <circle cx="20" cy="16" r="1.5" fill="#6366f1"/>
                            </svg>
                        </div>
                        <div class="loading-spinner"></div>
                    </div>
                    <h3 class="loading-title">Analyzing Your Financial Story</h3>
                    <p class="loading-text">Our AI is processing your statement with bank-grade precision...</p>
                </div>
            </section>

            <!-- Data Display Section -->
            <section id="dataSection" style="display: none;">

                <!-- Summary Cards -->
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon opening">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-label">Opening Balance</span>
                            <span class="summary-value" id="startBalance">$0.00</span>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon closing">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-label">Closing Balance</span>
                            <span class="summary-value" id="endBalance">$0.00</span>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon income">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                <polyline points="17 6 23 6 23 12"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-label">Total Income</span>
                            <span class="summary-value income-value" id="totalIncome">$0.00</span>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon expense">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
                                <polyline points="17 18 23 18 23 12"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-label">Total Expense</span>
                            <span class="summary-value expense-value" id="totalExpense">$0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Transaction Table -->
                <div class="card-box">
                    <h2 class="section-title">Transaction Details</h2>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Balance</th>
                                </tr>
                            </thead>
                            <tbody id="transactionTableBody">
                                <!-- Transaction rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="card-box">
                        <h2 class="section-title">Balance Trend</h2>
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="card-box">
                        <h2 class="section-title">Spending by Category</h2>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- AI Report Section -->
                <div class="card-box">
                    <div class="section-header">
                        <h2 class="section-title">AI Analysis Report</h2>
                        <button class="btn-export" onclick="exportReport()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            Export PDF
                        </button>
                    </div>
                    <div id="aiReport" class="ai-report">
                        <!-- AI report will be inserted here -->
                    </div>
                </div>

                <!-- Action Bar -->
                <div class="action-bar">
                    <button class="btn-secondary" onclick="resetUpload()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                            <path d="M8 16H3v5"/>
                        </svg>
                        Analyze Another Statement
                    </button>
                </div>

            </section>
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
